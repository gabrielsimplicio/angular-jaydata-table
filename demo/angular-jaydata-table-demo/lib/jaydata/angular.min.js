// JayData 1.4.0
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
(function(){Object.defineProperty($data.Entity.prototype,"_isNew",{get:function(){return!this.storeToken}});Object.defineProperty($data.Entity.prototype,"_isDirty",{get:function(){return!this._isNew&&this.changedProperties&&0<this.changedProperties.length}});var k=$data.Entity.prototype.save,l=$data.Entity.prototype.remove,i=$data.EntityContext.prototype.saveChanges,m=function(h){var h=h.expression.getJSON(),d=0,g,f;if(0==h.length)return d;for(g=0;g<h.length;g++)f=h.charCodeAt(g),d=(d<<5)-d+f,d&=
d;return d};angular.module("jaydata",["ng",["$provide",function(h){h.factory("$data",["$rootScope","$q",function(d,g){var f={};$data.Entity.prototype.hasOwnProperty=function(b){var a;return this.getType&&this.getType().memberDefinitions?(a=this.getType().memberDefinitions["$"+b])?"property"===a.kind&&a.enumerable:!1:Object.prototype.hasOwnProperty.apply(this,arguments)};$data.Queryable.prototype.toLiveArrayEx=function(b,a){function j(b){c.toArray().then(function(c){a.length=0;c.forEach(function(c){a.push(c)});
b.resolve(a)}).fail(b.reject).then(function(){n.$apply()})}function e(){$.Deferred(j).promise(a);return a}Array.isArray(b)&&(a=b,otions=void 0);var a=a||[],b=b||{},c=this,n=b.scope||d;a.refresh=e;return e()};$data.Queryable.prototype.toLiveArray=function(b){function a(a,b){if(a){var d="success"===b?c.successHandlers:c.errorHandlers;"completed"===c.state?a(c):d.push(a);return c}}var j=this;this.toTraceString();var e=m(this);if(f[e])return f[e];var c=[];f[e]=c;c.state="inprogress";c.successHandlers=
[];c.errorHandlers=[];b&&"function"===typeof b&&a(b,"success");c.then=c.success=function(c){return a(c,"success")};c.error=function(){return c};c.refresh=function(b){c.length=0;c.state="inprogress";a(b,"success");j.toArray({success:c.resolve,error:c.reject});return c};c.resolve=function(a){c.state="completed";a.forEach(function(a){c.push(a)});c.successHandlers.forEach(function(a){a(c)});d.$$phase||d.$apply()};c.reject=function(a){c.state="failed";c.errorHandlers.forEach(function(c){c(a)});d.$$phase||
d.$apply()};this.toArray({success:c.resolve,error:c.reject});return c};$data.Entity.prototype.save=function(){var b=this,a=g.defer();k.call(b).then(function(){f={};a.resolve(b);d.$$phase||d.$apply()}).fail(function(b){a.reject(b);d.$$phase||d.$apply()});return a.promise};$data.ItemStoreClass.prototype.EntityInstanceSave=function(b,a){var d=$data.ItemStore,e=this;return d._getStoreEntitySet(b,e).then(function(c){return d._getSaveMode(e,c,a,b).then(function(a){a=a||"add";switch(a){case "add":c.add(e);
break;case "attach":c.attach(e,!0);e.entityState=$data.EntityState.Modified;break;default:var b=new $data.PromiseHandler;b.createCallback().error("save mode not supported: "+a);return b.getPromise()}return i.call(c.entityContext).then(function(){d._setStoreAlias(e,c.entityContext.storeToken);return e})})})};$data.ItemStoreClass.prototype.EntityInstanceRemove=function(b){var a=this;return $data.ItemStore._getStoreEntitySet(b,a).then(function(b){b.remove(a);return i.call(b.entityContext).then(function(){return a})})};
$data.ItemStoreClass.prototype.EntityTypeRemoveAll=function(b){return function(a){return $data.ItemStore._getStoreEntitySet(a,b).then(function(a){return a.toArray().then(function(b){b.forEach(function(c){a.remove(c)});return i.call(a.entityContext).then(function(){return b})})})}};$data.ItemStoreClass.prototype.EntityTypeAddMany=function(b){return function(a,d){return $data.ItemStore._getStoreEntitySet(d,b).then(function(b){var c=b.addMany(a);return i.call(b.entityContext).then(function(){return c})})}};
$data.Entity.prototype.remove=function(){var b=g.defer(),a=this;l.call(a).then(function(){f={};b.resolve(a);d.$$phase||d.$apply()}).fail(function(a){b.reject(a);d.$$phase||d.$apply()});return b.promise};$data.EntityContext.prototype.saveChanges=function(){var b=g.defer();i.call(this).then(function(a){f={};b.resolve(a);d.$$phase||d.$apply()}).fail(function(a){b.reject(a);d.$$phase||d.$apply()});return b.promise};return $data}])}]])})();
